{
  "events": {
    "EVDAV": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out':[{'type': 'tracking', 'eventCode': 'EVDAV', 'eventName': 'Accepted at Depot', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId),  'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
            {
              "type": "csvAzure",
              "inputColumns": ["uniqueItemId"],
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "uniqueItemId"]],
              "output": ["address"],
              "outputColumns": ["add_line1", "add_line2", "city", "county", "country", "postcode"],
              "keyDelimiter": ":",
              "azure": {
                "accountName": "rmgparcelcheckpoint",
                "container": "address-lookup",
                "blobPath": "parcel_address.csv",
                "sasEnvVar": "RMG_SAS_TOKEN"
              }
            }
          ]
        }
      }
    },
    "EVIMC": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out':[{'type': 'tracking', 'eventCode': 'EVIMC', 'eventName': 'In Transit at Mail Centre', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId),  'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "manualScan", "RMGLocation", "functionalLocationId"]],
              "output": ["sortingCenter"],
              "lookup": {
                "1111": "London Sorting Centre",
                "2222": "Birmingham Sorting Centre",
                "3333": "Manchester Sorting Centre",
                "4444": "Glasgow Sorting Centre"
              }
            }
          ]
        }
      }
    },
    "EVGPD": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out':[{'type': 'tracking', 'eventCode': 'EVGPD', 'eventName': 'Out for Delivery', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'userId': string(message.MPE.manualScan.userId), 'deviceId': string(message.MPE.manualScan.deviceId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId),  'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'routeOrWalkNumber': string(message.MPE.manualScan.routeOrWalkNumber), 'longitude': string(message.MPE.manualScan.scanLocation.longitude), 'latitude': string(message.MPE.manualScan.scanLocation.latitude), 'altitude': string(message.MPE.manualScan.scanLocation.altitude)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["deliveryOffice"],
              "lookup": {
                "EC1A1BB": "London Delivery Office",
                "W1A0AX": "West End Delivery Office",
                "G11AA": "Glasgow Delivery Office",
                "M11AE": "Manchester Delivery Office",
                "B338TH": "Birmingham Delivery Office"
              }
            }
          ]
        }
      }
    },
    "ENKDN": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out':[{'type': 'tracking', 'eventCode': 'ENKDN', 'eventName': 'Delivered', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'userId': string(message.MPE.manualScan.userId), 'deviceId': string(message.MPE.manualScan.deviceId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId),  'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'routeOrWalkNumber': string(message.MPE.manualScan.routeOrWalkNumber), 'longitude': string(message.MPE.manualScan.scanLocation.longitude), 'latitude': string(message.MPE.manualScan.scanLocation.latitude), 'altitude': string(message.MPE.manualScan.scanLocation.altitude)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["deliveryLocation"],
              "lookup": {
                "EC1A1BB": "Customer Address - London",
                "W1A0AX": "Customer Address - West End",
                "G11AA": "Customer Address - Glasgow",
                "M11AE": "Customer Address - Manchester",
                "B338TH": "Customer Address - Birmingham"
              }
            }
          ]
        }
      }
    }
  }
}