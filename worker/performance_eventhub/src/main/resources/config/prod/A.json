{
  "events": {
    "EVDAV": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out': (has(message.MPE.manualScan.auxiliaryData) && has(message.MPE.manualScan.auxiliaryData.data) && message.MPE.manualScan.auxiliaryData.data.size() > 0 && message.MPE.manualScan.auxiliaryData.data[0].name == 'RECIPIENT_EMAILID' && message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId == '100') ? [{'type': 'notification', 'trackedEventCode': 'NRARS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data[0].value), 'notificationDestinationType': '1', 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [] + [{'type': 'tracking', 'eventCode': 'EVDAV', 'eventName': 'Accepted at Depot', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId), 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
            {
              "type": "csvAzure",
              "inputs": [
                [ "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]
              ],
              "inputColumns": ["postcode"],
              "output": ["address"],
              "outputColumns": ["add_line1", "add_line2", "city", "county", "country", "postcode"],
              "azure": {
                 "accountName":"rmgparcelcheckpoint",
                 "container": "address-lookup",
                 "blobPath": "parcel_address.csv",
                 "sasEnvVar": "AZURE_SAS_TOKEN"
              }

            }
          ]
        }
      }
    },
    "EVIMC": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out': [{'type': 'tracking', 'eventCode': 'EVIMC', 'eventName': 'Accepted at Mail Centre', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId), 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
          ]
        }
      }
    },
    "EVGPD": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out': (has(message.MPE.manualScan.auxiliaryData) && has(message.MPE.manualScan.auxiliaryData.data) && message.MPE.manualScan.auxiliaryData.data.size() > 0 && message.MPE.manualScan.auxiliaryData.data[0].name == 'RECIPIENT_EMAILID' && message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId == '100') ? [{'type': 'notification', 'trackedEventCode': 'NRBRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data[0].value), 'notificationDestinationType': '1', 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [] + [{'type': 'tracking', 'eventCode': 'EVGPD', 'eventName': 'Out for Delivery', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'userId': string(message.MPE.manualScan.userId), 'deviceId': string(message.MPE.manualScan.deviceId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId), 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'longitude': string(message.MPE.manualScan.scanLocation.longitude), 'latitude': string(message.MPE.manualScan.scanLocation.latitude), 'altitude': string(message.MPE.manualScan.scanLocation.altitude)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
          ]
        }
      }
    },
    "ENKDN": {
      "bizlogic": {
        "all": {
          "type": "cel",
          "cel": "{'out': (has(message.MPE.manualScan.auxiliaryData) && has(message.MPE.manualScan.auxiliaryData.data) && message.MPE.manualScan.auxiliaryData.data.size() > 0 && message.MPE.manualScan.auxiliaryData.data[0].name == 'RECIPIENT_EMAILID' && message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId == '100') ? [{'type': 'notification', 'trackedEventCode': 'NRCRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data[0].value), 'notificationDestinationType': '1', 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [] + [{'type': 'tracking', 'eventCode': 'ENKDN', 'eventName': 'Delivered', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'userId': string(message.MPE.manualScan.userId), 'deviceId': string(message.MPE.manualScan.deviceId), 'functionalLocationId': string(message.MPE.manualScan.RMGLocation.functionalLocationId), 'siteId': string(message.MPE.manualScan.RMGLocation.siteId), 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'longitude': string(message.MPE.manualScan.scanLocation.longitude), 'latitude': string(message.MPE.manualScan.scanLocation.latitude), 'altitude': string(message.MPE.manualScan.scanLocation.altitude)}]}"
        }
      },
      "enrichment": {
        "all": {
          "type": "composite",
          "enrichers": [
          ]
        }
      }
    }
  }
}