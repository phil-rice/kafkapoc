{
  "events": {
    "EVDAV": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRARS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRGRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRGRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRJRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : [])"
        },
        "tracking": {
          "type": "cel",
          "cel": "[{'type': 'tracking', 'eventCode': 'EVDAV', 'eventName': 'Accepted at Depot', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]"
        },
        "all": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRARS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRGRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRGRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRJRS', 'originatingTrackedEventCode': 'EVDAV', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : []) + [{'type': 'tracking', 'eventCode': 'EVDAV', 'eventName': 'Accepted at Depot', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]"
        }
      },
      "enrichment": {
        "notification": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["postcodeRegion"],
              "lookup": {
                "EC1A1BB": "London Central",
                "W1A0AX": "London West End",
                "G11AA": "Glasgow City",
                "M11AE": "Manchester Central",
                "B338TH": "Birmingham"
              }
            }
          ]
        }
      }
    },
    "EVIMC": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "[]"
        },
        "tracking": {
          "type": "cel",
          "cel": "[{'type': 'tracking', 'eventCode': 'EVIMC', 'eventName': 'Accepted at Mail Centre', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]"
        },
        "all": {
          "type": "cel",
          "cel": "[] + [{'type': 'tracking', 'eventCode': 'EVIMC', 'eventName': 'Accepted at Mail Centre', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry)}]"
        }
      },
      "enrichment": {
        "notification": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["postcodeRegion"],
              "lookup": {
                "EC1A1BB": "London Central",
                "W1A0AX": "London West End",
                "G11AA": "Glasgow City",
                "M11AE": "Manchester Central",
                "B338TH": "Birmingham"
              }
            }
          ]
        }
      }
    },
    "EVGPD": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRBRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRBRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'Tracked48' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRERS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRERS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRHRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRHRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRKRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRKRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : [])"
        },
        "tracking": {
          "type": "cel",
          "cel": "[{'type': 'tracking', 'eventCode': 'EVGPD', 'eventName': 'Out for Delivery', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'userId': has(message.MPE.manualScan.userId) ? string(message.MPE.manualScan.userId) : '', 'deviceId': has(message.MPE.manualScan.deviceId) ? string(message.MPE.manualScan.deviceId) : '', 'routeOrWalkNumber': has(message.MPE.manualScan.routeOrWalkNumber) ? string(message.MPE.manualScan.routeOrWalkNumber) : '', 'longitude': has(message.MPE.manualScan.scanLocation.longitude) ? string(message.MPE.manualScan.scanLocation.longitude) : '', 'latitude': has(message.MPE.manualScan.scanLocation.latitude) ? string(message.MPE.manualScan.scanLocation.latitude) : '', 'altitude': has(message.MPE.manualScan.scanLocation.altitude) ? string(message.MPE.manualScan.scanLocation.altitude) : ''}]"
        },
        "all": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRBRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRBRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'Tracked48' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRERS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRERS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRHRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRHRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRKRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRKRS', 'originatingTrackedEventCode': 'EVGPD', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : []) + [{'type': 'tracking', 'eventCode': 'EVGPD', 'eventName': 'Out for Delivery', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'userId': has(message.MPE.manualScan.userId) ? string(message.MPE.manualScan.userId) : '', 'deviceId': has(message.MPE.manualScan.deviceId) ? string(message.MPE.manualScan.deviceId) : '', 'routeOrWalkNumber': has(message.MPE.manualScan.routeOrWalkNumber) ? string(message.MPE.manualScan.routeOrWalkNumber) : '', 'longitude': has(message.MPE.manualScan.scanLocation.longitude) ? string(message.MPE.manualScan.scanLocation.longitude) : '', 'latitude': has(message.MPE.manualScan.scanLocation.latitude) ? string(message.MPE.manualScan.scanLocation.latitude) : '', 'altitude': has(message.MPE.manualScan.scanLocation.altitude) ? string(message.MPE.manualScan.scanLocation.altitude) : ''}]"
        }
      },
      "enrichment": {
        "notification": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["postcodeRegion"],
              "lookup": {
                "EC1A1BB": "London Central",
                "W1A0AX": "London West End",
                "G11AA": "Glasgow City",
                "M11AE": "Manchester Central",
                "B338TH": "Birmingham"
              }
            }
          ]
        }
      }
    },
    "ENKDN": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRCRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'Tracked48' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRFRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRIRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRLRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRLRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : [])"
        },
        "tracking": {
          "type": "cel",
          "cel": "[{'type': 'tracking', 'eventCode': 'ENKDN', 'eventName': 'Delivered', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'userId': has(message.MPE.manualScan.userId) ? string(message.MPE.manualScan.userId) : '', 'deviceId': has(message.MPE.manualScan.deviceId) ? string(message.MPE.manualScan.deviceId) : ''}]"
        },
        "all": {
          "type": "cel",
          "cel": "(has(enrichment.productCategory.productCategory) && has(message.MPE.manualScan.auxiliaryData.data) ? (enrichment.productCategory.productCategory == 'Tracked24' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRCRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'Tracked48' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRFRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery09' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRIRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : enrichment.productCategory.productCategory == 'SpecialDelivery13' ? ((message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_EMAILID') ? [{'type': 'notification', 'trackedEventCode': 'NRLRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value), 'notificationDestinationType': string(1), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : []) + (message.MPE.manualScan.auxiliaryData.data.exists(d, d.name == 'RECIPIENT_MOBILENO') ? [{'type': 'notification', 'trackedEventCode': 'NRLRS', 'originatingTrackedEventCode': 'ENKDN', 'notificationDestination': string(message.MPE.manualScan.auxiliaryData.data.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value), 'notificationDestinationType': string(2), 'notificationRecipientType': 'R', 'eventTimestamp': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber)}] : [])) : []) : []) + [{'type': 'tracking', 'eventCode': 'ENKDN', 'eventName': 'Delivered', 'eventDateTime': string(message.MPE.manualScan.eventTimestamp), 'uniqueItemId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.uniqueItemId), 'UPUTrackingNumber': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber), 'productId': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.productId), 'productName': string(enrichment.productCategory.productCategory), 'functionalLocationId': has(message.MPE.manualScan.RMGLocation.functionalLocationId) ? string(message.MPE.manualScan.RMGLocation.functionalLocationId) : '', 'siteId': has(message.MPE.manualScan.RMGLocation.siteId) ? string(message.MPE.manualScan.RMGLocation.siteId) : '', 'locationName': has(enrichment.postcodeRegion) ? string(enrichment.postcodeRegion) : '', 'postcode': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode), 'destinationCountry': string(message.MPE.mailPiece.mailPieceBarcode.channelSegment.destinationCountry), 'userId': has(message.MPE.manualScan.userId) ? string(message.MPE.manualScan.userId) : '', 'deviceId': has(message.MPE.manualScan.deviceId) ? string(message.MPE.manualScan.deviceId) : ''}]"
        }
      },
      "enrichment": {
        "notification": {
          "type": "composite",
          "enrichers": [
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "productId"]],
              "output": ["productCategory"],
              "lookup": {
                "100": {"productCategory": "Tracked24"},
                "101": {"productCategory": "Tracked48"},
                "102": {"productCategory": "SpecialDelivery09"},
                "103": {"productCategory": "SpecialDelivery13"}
              }
            },
            {
              "type": "lookup",
              "inputs": [["message", "MPE", "mailPiece", "mailPieceBarcode", "channelSegment", "destinationPostcodeDPS", "postcode"]],
              "output": ["postcodeRegion"],
              "lookup": {
                "EC1A1BB": "London Central",
                "W1A0AX": "London West End",
                "G11AA": "Glasgow City",
                "M11AE": "Manchester Central",
                "B338TH": "Birmingham"
              }
            }
          ]
        }
      }
    }
  }
}

