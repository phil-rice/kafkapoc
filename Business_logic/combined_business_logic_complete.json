{
  "events": {
    "EVDAV": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "{\n  'out': (\n    has(enrichment.productCategory.productCategory) && \n    has(manualScan.auxiliaryData) ?\n    \n    (enrichment.productCategory.productCategory == 'Tracked24' ? \n      (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n        [\n          {\n            'type': 'notification',\n            'trackedEventCode': 'NRARS',\n            'originatingTrackedEventCode': 'EVDAV',\n            'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n            'notificationDestinationType': 1,\n            'notificationRecipientType': 'R',\n            'eventTimestamp': manualScan.eventTimestamp,\n            'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n            'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n          }\n        ] \n        : []\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery09' ?\n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRGRS',\n              'originatingTrackedEventCode': 'EVDAV',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRGRS',\n              'originatingTrackedEventCode': 'EVDAV',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery13' ?\n      (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n        [\n          {\n            'type': 'notification',\n            'trackedEventCode': 'NRJRS',\n            'originatingTrackedEventCode': 'EVDAV',\n            'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n            'notificationDestinationType': 2,\n            'notificationRecipientType': 'R',\n            'eventTimestamp': manualScan.eventTimestamp,\n            'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n            'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n          }\n        ] \n        : []\n      )\n    : []\n    )\n    : []\n  )\n}"
        },
        "tracking": {
          "type": "cel",
          "cel": "{\n  'out': [\n    {\n      'type': 'tracking',\n      'eventCode': 'EVDAV',\n      'eventName': 'Accepted at Depot',\n      'eventDateTime': manualScan.eventTimestamp,\n      'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n      'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber,\n      'productId': mailPiece.mailPieceBarcode.channelSegment.productId,\n      'productName': enrichment.productCategory.productCategory,\n      'functionalLocationId': has(manualScan.RMGLocation.functionalLocationId) ? manualScan.RMGLocation.functionalLocationId : '',\n      'siteId': has(manualScan.RMGLocation.siteId) ? manualScan.RMGLocation.siteId : '',\n      'locationName': has(enrichment.postcodeRegion) ? enrichment.postcodeRegion : '',\n      'postcode': mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode,\n      'destinationCountry': mailPiece.mailPieceBarcode.channelSegment.destinationCountry\n    }\n  ]\n}"
        }
      }
    },
    "EVIMC": {
      "bizlogic": {
        "tracking": {
          "type": "cel",
          "cel": "{\n  'out': [\n    {\n      'type': 'tracking',\n      'eventCode': 'EVIMC',\n      'eventName': 'In Transit at Mail Centre',\n      'eventDateTime': manualScan.eventTimestamp,\n      'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n      'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber,\n      'productId': mailPiece.mailPieceBarcode.channelSegment.productId,\n      'productName': enrichment.productCategory.productCategory,\n      'functionalLocationId': has(manualScan.RMGLocation.functionalLocationId) ? manualScan.RMGLocation.functionalLocationId : '',\n      'siteId': has(manualScan.RMGLocation.siteId) ? manualScan.RMGLocation.siteId : '',\n      'locationName': has(enrichment.sortingCenter) ? enrichment.sortingCenter : '',\n      'postcode': mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode,\n      'destinationCountry': mailPiece.mailPieceBarcode.channelSegment.destinationCountry\n    }\n  ]\n}"
        }
      }
    },
    "EVGPD": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "{\n  'out': (\n    has(enrichment.productCategory.productCategory) && \n    has(manualScan.auxiliaryData) ?\n    \n    (enrichment.productCategory.productCategory == 'Tracked24' ? \n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRBRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRBRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    :\n    enrichment.productCategory.productCategory == 'Tracked48' ?\n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRERS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRERS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery09' ?\n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRHRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRHRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery13' ?\n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRKRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRKRS',\n              'originatingTrackedEventCode': 'EVGPD',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    : []\n    )\n    : []\n  )\n}"
        },
        "tracking": {
          "type": "cel",
          "cel": "{\n  'out': [\n    {\n      'type': 'tracking',\n      'eventCode': 'EVGPD',\n      'eventName': 'Out for Delivery',\n      'eventDateTime': manualScan.eventTimestamp,\n      'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n      'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber,\n      'productId': mailPiece.mailPieceBarcode.channelSegment.productId,\n      'productName': enrichment.productCategory.productCategory,\n      'userId': has(manualScan.userId) ? manualScan.userId : '',\n      'deviceId': has(manualScan.deviceId) ? manualScan.deviceId : '',\n      'functionalLocationId': has(manualScan.RMGLocation.functionalLocationId) ? manualScan.RMGLocation.functionalLocationId : '',\n      'siteId': has(manualScan.RMGLocation.siteId) ? manualScan.RMGLocation.siteId : '',\n      'locationName': has(enrichment.deliveryOffice) ? enrichment.deliveryOffice : '',\n      'postcode': mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode,\n      'destinationCountry': mailPiece.mailPieceBarcode.channelSegment.destinationCountry,\n      'routeOrWalkNumber': has(manualScan.routeOrWalkNumber) ? manualScan.routeOrWalkNumber : '',\n      'longitude': has(manualScan.scanLocation.longitude) ? manualScan.scanLocation.longitude : 0.0,\n      'latitude': has(manualScan.scanLocation.latitude) ? manualScan.scanLocation.latitude : 0.0,\n      'altitude': has(manualScan.scanLocation.altitude) ? manualScan.scanLocation.altitude : 0.0\n    }\n  ]\n}"
        }
      }
    },
    "ENKDN": {
      "bizlogic": {
        "notification": {
          "type": "cel",
          "cel": "{\n  'out': (\n    has(enrichment.productCategory.productCategory) && \n    has(manualScan.auxiliaryData) ?\n    \n    (enrichment.productCategory.productCategory == 'Tracked24' ? \n      (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n        [\n          {\n            'type': 'notification',\n            'trackedEventCode': 'NRCRS',\n            'originatingTrackedEventCode': 'ENKDN',\n            'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n            'notificationDestinationType': 1,\n            'notificationRecipientType': 'R',\n            'eventTimestamp': manualScan.eventTimestamp,\n            'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n            'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n          }\n        ] \n        : []\n      )\n    :\n    enrichment.productCategory.productCategory == 'Tracked48' ?\n      (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n        [\n          {\n            'type': 'notification',\n            'trackedEventCode': 'NRFRS',\n            'originatingTrackedEventCode': 'ENKDN',\n            'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n            'notificationDestinationType': 2,\n            'notificationRecipientType': 'R',\n            'eventTimestamp': manualScan.eventTimestamp,\n            'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n            'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n          }\n        ] \n        : []\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery09' ?\n      (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n        [\n          {\n            'type': 'notification',\n            'trackedEventCode': 'NRIRS',\n            'originatingTrackedEventCode': 'ENKDN',\n            'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n            'notificationDestinationType': 2,\n            'notificationRecipientType': 'R',\n            'eventTimestamp': manualScan.eventTimestamp,\n            'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n            'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n          }\n        ] \n        : []\n      )\n    :\n    enrichment.productCategory.productCategory == 'SpecialDelivery13' ?\n      (\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_EMAILID') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRLRS',\n              'originatingTrackedEventCode': 'ENKDN',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_EMAILID')[0].value,\n              'notificationDestinationType': 1,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        ) +\n        (manualScan.auxiliaryData.exists(d, d.name == 'RECIPIENT_MOBILENO') ? \n          [\n            {\n              'type': 'notification',\n              'trackedEventCode': 'NRLRS',\n              'originatingTrackedEventCode': 'ENKDN',\n              'notificationDestination': manualScan.auxiliaryData.filter(d, d.name == 'RECIPIENT_MOBILENO')[0].value,\n              'notificationDestinationType': 2,\n              'notificationRecipientType': 'R',\n              'eventTimestamp': manualScan.eventTimestamp,\n              'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n              'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber\n            }\n          ] \n          : []\n        )\n      )\n    : []\n    )\n    : []\n  )\n}"
        },
        "tracking": {
          "type": "cel",
          "cel": "{\n  'out': [\n    {\n      'type': 'tracking',\n      'eventCode': 'ENKDN',\n      'eventName': 'Delivered',\n      'eventDateTime': manualScan.eventTimestamp,\n      'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n      'UPUTrackingNumber': mailPiece.mailPieceBarcode.channelSegment.UPUTrackingNumber,\n      'productId': mailPiece.mailPieceBarcode.channelSegment.productId,\n      'productName': enrichment.productCategory.productCategory,\n      'userId': has(manualScan.userId) ? manualScan.userId : '',\n      'deviceId': has(manualScan.deviceId) ? manualScan.deviceId : '',\n      'functionalLocationId': has(manualScan.RMGLocation.functionalLocationId) ? manualScan.RMGLocation.functionalLocationId : '',\n      'siteId': has(manualScan.RMGLocation.siteId) ? manualScan.RMGLocation.siteId : '',\n      'locationName': has(enrichment.deliveryLocation) ? enrichment.deliveryLocation : '',\n      'postcode': mailPiece.mailPieceBarcode.channelSegment.destinationPostcodeDPS.postcode,\n      'destinationCountry': mailPiece.mailPieceBarcode.channelSegment.destinationCountry,\n      'routeOrWalkNumber': has(manualScan.routeOrWalkNumber) ? manualScan.routeOrWalkNumber : '',\n      'longitude': has(manualScan.scanLocation.longitude) ? manualScan.scanLocation.longitude : 0.0,\n      'latitude': has(manualScan.scanLocation.latitude) ? manualScan.scanLocation.latitude : 0.0,\n      'altitude': has(manualScan.scanLocation.altitude) ? manualScan.scanLocation.altitude : 0.0\n    }\n  ]\n}"
        },
        "billing": {
          "type": "cel",
          "cel": "{\n  'out': [\n    {\n      'type': 'billing',\n      'billingCode': 'DELIVERY_COMPLETE',\n      'eventCode': 'ENKDN',\n      'uniqueItemId': mailPiece.mailPieceBarcode.channelSegment.uniqueItemId,\n      'productId': mailPiece.mailPieceBarcode.channelSegment.productId,\n      'productCategory': enrichment.productCategory.productCategory,\n      'eventTimestamp': manualScan.eventTimestamp,\n      'pricePaid': has(mailPiece.mailPieceBarcode.channelSegment.pricePaid) ? mailPiece.mailPieceBarcode.channelSegment.pricePaid : 0\n    }\n  ]\n}"
        }
      }
    }
  }
}

